<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Stealth</title>

<link href="https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
:root{
    --bg: #f5f5f7;
    --card: rgba(255,255,255,0.6);
    --border: rgba(0,0,0,0.08);
    --text: #1d1d1f;
    --subtext: #6e6e73;
    --primary: #0071e3;
}

*{
    margin:0;
    padding:0;
    box-sizing:border-box;
    font-family:-apple-system, BlinkMacSystemFont, "SF Pro Display", sans-serif;
}

body{
    background:var(--bg);
    min-height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:20px;
}

.container{
    width:100%;
    max-width:620px;
    background:var(--card);
    backdrop-filter: blur(25px);
    border-radius:28px;
    padding:40px;
    box-shadow:
        0 20px 60px rgba(0,0,0,0.08),
        inset 0 1px 0 rgba(255,255,255,0.6);
    border:1px solid var(--border);
    transition:all .3s ease;
}

h1{
    font-size:28px;
    font-weight:600;
    color:var(--text);
    margin-bottom:6px;
}

.subtitle{
    font-size:15px;
    color:var(--subtext);
    margin-bottom:30px;
}

.drop-area{
    border:2px dashed var(--border);
    border-radius:20px;
    padding:30px;
    text-align:center;
    cursor:pointer;
    transition:.25s;
    background:white;
}

.drop-area:hover{
    border-color:var(--primary);
}

.drop-area p{
    font-size:14px;
    color:var(--subtext);
}

.preview-wrapper{
    margin-top:20px;
    display:none;
    text-align:center;
}

.preview-wrapper img{
    max-width:100%;
    border-radius:18px;
    box-shadow:0 10px 30px rgba(0,0,0,0.1);
    opacity:0;
    transform:scale(.98);
    transition:.4s ease;
}

.preview-wrapper img.show{
    opacity:1;
    transform:scale(1);
}

textarea{
    width:100%;
    margin-top:25px;
    border-radius:18px;
    border:1px solid var(--border);
    padding:16px;
    font-size:15px;
    resize:none;
    height:110px;
    outline:none;
    transition:.2s;
}

textarea:focus{
    border-color:var(--primary);
}

.buttons{
    margin-top:20px;
    display:flex;
    gap:12px;
}

button{
    flex:1;
    padding:14px;
    border-radius:14px;
    border:none;
    font-weight:500;
    font-size:15px;
    cursor:pointer;
    transition:.25s;
}

.primary{
    background:var(--primary);
    color:white;
}

.primary:hover{
    background:#005bb5;
}

.secondary{
    background:#e8e8ed;
    color:var(--text);
}

.secondary:hover{
    background:#dcdce1;
}

#output{
    margin-top:18px;
    font-size:14px;
    color:var(--text);
    word-break:break-word;
}

canvas{ display:none; }

@media(max-width:500px){
    .container{ padding:25px; }
}
</style>
</head>
<body>

<div class="container">
    <h1>Stealth</h1>
    <div class="subtitle">Embed invisible messages inside images.</div>

    <div class="drop-area" id="dropArea">
        <p>Click or drag an image here</p>
        <input type="file" id="fileInput" accept="image/png,image/jpeg" hidden>
    </div>

    <div class="preview-wrapper" id="previewWrapper">
        <img id="previewImage">
    </div>

    <textarea id="secretText" placeholder="Enter hidden message..."></textarea>

    <div class="buttons">
        <button class="primary" onclick="encode()">Encode</button>
        <button class="secondary" onclick="decode()">Decode</button>
    </div>

    <div id="output"></div>
</div>

<canvas id="canvas"></canvas>

<script>
let selectedFile = null;
const dropArea = document.getElementById("dropArea");
const fileInput = document.getElementById("fileInput");
const previewWrapper = document.getElementById("previewWrapper");
const previewImage = document.getElementById("previewImage");

dropArea.onclick = () => fileInput.click();

fileInput.onchange = e => handleFile(e.target.files[0]);

dropArea.ondragover = e => {
    e.preventDefault();
    dropArea.style.borderColor = "#0071e3";
};

dropArea.ondragleave = () => {
    dropArea.style.borderColor = "rgba(0,0,0,0.08)";
};

dropArea.ondrop = e => {
    e.preventDefault();
    handleFile(e.dataTransfer.files[0]);
};

function handleFile(file){
    if(!file) return;
    selectedFile = file;

    const reader = new FileReader();
    reader.onload = e => {
        previewWrapper.style.display = "block";
        previewImage.src = e.target.result;
        setTimeout(()=>previewImage.classList.add("show"),50);
    };
    reader.readAsDataURL(file);
}

function textToBinary(text){
    return text.split("").map(c =>
        c.charCodeAt(0).toString(2).padStart(8,"0")
    ).join("") + "1111111111111110";
}

function encode(){
    if(!selectedFile) return alert("Select image first");
    const text = document.getElementById("secretText").value;
    if(!text) return alert("Enter message");

    const img = new Image();
    img.src = URL.createObjectURL(selectedFile);

    img.onload = function(){
        const canvas = document.getElementById("canvas");
        const ctx = canvas.getContext("2d");
        canvas.width = img.width;
        canvas.height = img.height;
        ctx.drawImage(img,0,0);

        const binary = textToBinary(text);
        const imageData = ctx.getImageData(0,0,canvas.width,canvas.height);
        const data = imageData.data;

        let j=0;
        for(let i=0;i<data.length && j<binary.length;i+=4){
            data[i] = (data[i] & 254) | parseInt(binary[j]);
            j++;
        }

        ctx.putImageData(imageData,0,0);

        const link = document.createElement("a");
        link.download="stealth.png";
        link.href=canvas.toDataURL("image/png");
        link.click();
    }
}

function decode(){
    if(!selectedFile) return alert("Upload image");

    const img = new Image();
    img.src = URL.createObjectURL(selectedFile);

    img.onload = function(){
        const canvas = document.getElementById("canvas");
        const ctx = canvas.getContext("2d");
        canvas.width = img.width;
        canvas.height = img.height;
        ctx.drawImage(img,0,0);

        const imageData = ctx.getImageData(0,0,canvas.width,canvas.height);
        const data = imageData.data;

        let binary="";
        for(let i=0;i<data.length;i+=4){
            binary += (data[i]&1);
            if(binary.endsWith("1111111111111110")) break;
        }

        binary = binary.replace(/1111111111111110$/,"");

        let message="";
        for(let i=0;i<binary.length;i+=8){
            message += String.fromCharCode(parseInt(binary.substr(i,8),2));
        }

        document.getElementById("output").innerText="Decoded: "+message;
    }
}
</script>

</body>
</html>
